<html lang="en" data-text="normal">
   <head>
      <!-- PAGE INFO -->
      <title>XLink</title>
      <link rel="icon" href="{{url_for('static', filename='logo.png')}}" type="image/x-icon">
      <!-- CSS -->
      <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, viewport-fit=cover">
      <link rel="stylesheet" href="{{url_for('static', filename='style.css')}}">
      <style type="text/css">
         @font-face { font-family: Roboto; src: url("chrome-extension://mcgbeeipkmelnpldkobichboakdfaeon/css/Roboto-Regular.ttf"); }
         /* Navbar container styles */
         .mynavbar {
         position: absolute;
         bottom: 0!important;
         width: 100%;
         height: 50px;
         display: flex;
         justify-content: space-between;
         align-items: center;
         padding: 20px;
         background-color: #33353B;
         z-index: 999;
         }
         /* Navbar label styles */
         .mynavbar a {
         font-size: 1rem;
         font-weight: 600;
         color: white;
         text-decoration: none;
         text-align: center;
         flex-basis: 33.33%;
         padding: 10px;
         box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.25);
         border: 1px solid transparent;
         transition: all 0.3s ease-in-out;
         }
         .mynavbar a:hover {
             box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
             border: 1px solid white;
         }
         /* Media query for responsiveness */
         @media screen and (max-width: 768px) {
         /* Navbar label styles */
         .mynavbar a {
         font-size: 0.8rem;
         padding: 5px;
         }
         }
         .chip {
         display: inline-block;
         background-color: #292B31;
         padding: 0 18px;
         margin: 4px 2px;
         border-radius: 16px;
         font-size: 0.8rem;
         line-height: 32px;
         height: 32px;
         color: white;
         }
         .chip .close {
         margin-left: 8px;
         font-size: 0.6rem;
         font-weight: bold;
         cursor: pointer;
         color: white;
         background-color: transparent;
         border: none;
         }
         .chip .close:hover {
         color: white;
         }
      </style>
   </head>
   <body class="" data-theme="dark" cz-shortcut-listen="true">
      <!-- Uses a transparent header that draws on top of the layout's background -->
    <style>
    .demo-layout-transparent {
        height: 100vh!important;
    }
    .demo-layout-transparent .mdl-layout__header,
    .demo-layout-transparent .mdl-layout__drawer-button {
      /* This background is dark, so we set text to white. Use 87% black instead if
         your background is light. */
      color: grey;
      position: sticky!important;
      top: 0!important;
    }
    </style>


     <!-- Modal overlay -->
      <div id="modal-overlay"></div>
      
      <!-- Modal box -->
      <div id="modal-box">
        <div class="close-btn" onclick="closeModal()"></div>
        <div id="announcement-text" style="text-align: center;">
            <table style="margin: 0 auto!important;;text-align: center;">
               <tr>
                  <td><img src="https://1.bp.blogspot.com/-l_CBUtQxwRk/XmkkGnEuVZI/AAAAAAAA0zU/FpQtqOiERbgg9RiaHLCegQEY-UuLzlkZgCLcBGAsYHQ/s1600/images%2B%25282%2529.png" style="width:50px;filter:hue-rotate(0.7turn) brightness(1.2)" />
                  </td>
                  <td style='font-family: "Times New Roman", Times, serif;text-align: center;color:green;margin: 0 auto!important;' style="filter:brightness(1.2)"><span style="font-family: 'Times New Roman', Times, serif;font-size:40px">PSG</span><br/><span style="font-family: 'Times New Roman', Times, serif;font-size:15px">COLLEGE OF TECHNOLOGY</span></td>
               </tr>
            </table>
            <br/>
            <img src="{{url_for('profile_picture')}}" alt="" style="width: 80%!important;text-align: center;"><br/><br/>
            <span><b>{{details["student"][0][2]}}</b></span><br/>
            <span><b>{{course}} {{details["student"][0][-1]}}</b></span><br/>
            <img src="https://bwipjs-api.metafloor.com/?bcid=code128&text={{details['student'][0][-1]}}" style="width:80%;height:60px!important" /><br/><br/>
            <div style="background-color:green;color:white">
               Peelamedu, Coimbatore-641004<br/>
               Phone 0422-2572177,4344777
            </div>
        </div>
        
      </div>
      
      <script>
        function openModal() {
          // Show the modal overlay and box
          document.getElementById("modal-overlay").style.display = "block";
          document.getElementById("modal-box").style.display = "block";
        }
        
        function closeModal() {
          // Hide the modal overlay and box
          document.getElementById("modal-overlay").style.display = "none";
          document.getElementById("modal-box").style.display = "none";
        }

        window.onclick = function(event) {
          if (event.target == document.getElementById("modal-overlay")) {
            closeModal();
          }
        }

      </script>


      <style type="text/css">

        /* Style for the modal overlay */
      #modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 999;
        display: none;
      }
      
      /* Style for the modal box */
      #modal-box {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #fff;
        padding: 20px;
        width: 400px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        display: none;
      }
      
      /* Style for the modal title */
      #modal-title {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 10px;
      }
      
      /* Style for the announcement ID */
      #announcement-id {
        font-size: 16px;
        color: #999;
        margin-bottom: 10px;
      }
      
      /* Style for the announcement text */
      #announcement-text {
        font-size: 18px;
        line-height: 1.5;
      }

      /* Style for the close button */
      .close-btn {
        position: absolute;
        top: 10px;
        right: 25px;
        font-size: 24px;
        cursor: pointer;
      }
      
      /* Style for the X mark */
      .close-btn::before,
      .close-btn::after {
        position: absolute;
        content: "";
        height: 30px;
        width: 3px;
        background-color: #333;
      }
      
      .close-btn::before {
        transform: rotate(45deg);
      }
      
      .close-btn::after {
        transform: rotate(-45deg);
      }

      /* Media query styles */
      @media only screen and (max-width: 768px) {
        #modal-box {
          width: 90%;
          max-width: 600px;
        }
      }
      
      @media only screen and (max-width: 480px) {
        #modal-box {
          width: 95%;
          max-width: 400px;
        }
        
        #modal-title {
          font-size: 20px;
        }
        
        #announcement-id {
          font-size: 14px;
        }
        
        #announcement-text {
          font-size: 16px;
        }
      </style>

      <header>
         <div class="menu-icon left">
            <img src="{{url_for('static', filename='logo.png')}}" style="-webkit-filter: invert(100%); filter: invert(100%);" alt="" style="">
         </div>
         <a class="main-logo left">
         <img src="{{url_for('static', filename='logo.png')}}" style="-webkit-filter: invert(100%); filter: invert(100%);">
         <span class="notranslate" translate="no">XLink</span>
         </a>
         <div class="menu-icon right profile-picture" onclick="openModal()">
            <img src="{{url_for('profile_picture')}}" alt="" style="border-radius: 50%;">
         </div>
         <div class="airac-status right airac-default">
            <span><span class="notranslate" translate="no">{{details["student"][0][2]}}</span></span>
         </div>
      </header>
      <!-- MAIN CONTENT -->
      <main class="" id="index">
         <div class="page-actions">
            <a style="cursor: pointer;" class="dashboard-tab active">
            <span class="hide-medium">Mass <span data-key="user.first_name">Attendance</span></span>
            <span class="show-medium"><span class="show-very-narrow">Mass</span><span class="hide-very-narrow">Mass</span></span>
            </a>
            <a href="{{url_for('facLookup')}}" class="dashboard-tab">
            <span class="hide-medium">Faculty <span data-key="user.first_name">Lookup</span></span>
            <span class="show-medium"><span class="show-very-narrow">Faculty</span><span class="hide-very-narrow">Faculty</span></span>
            </a>
            <a href="{{url_for('my_tt')}}" class="dashboard-tab">
            <span class="hide-narrow">My Time Table</span>
            <span class="show-narrow">TimeTable</span>
            </a>
            <a href="{{url_for('map')}}" class="dashboard-tab">
            <span class="hide-narrow">Campus Map</span>
            <span class="show-narrow">Map</span>
            </a>
            <a href="{{url_for('logout')}}" class="dashboard-tab">
            <span class="hide-medium">Logout</span>
            <span class="show-medium">Logout</span>
            </a>
         </div>
         <div class="page-content scrollable">
            <figure>
               <div class="page-options page-quarter">
                  <div style="height:auto!important;max-height:100vh;">
                     <div>
                        <figure class="full"><br/>
                           <h2 data-key="flightplans.0.flight_number">Year Plan</h2>
                           <br/>
                           <h2 data-key="flightplans.0.flight_number">
                           <select onchange="updateYearPlan(this)">

                              <option>Year Plan View</option>
                              {% for i in CYPLst %}

                                 <option value="{{i['id']}}">{{i["name"]}}</option>

                              {% endfor %}   
                           </select>
                        </h2>
                        </figure><br/>
                        <figure class="full">
                           <span>Last Date: <span id="lastDate"></span></span><br/>
                           <span>Remaining Days: <span id="remDays"></span></span><br/>
                           <span>Working Days: <span id="totalWorkingDays"></span></span>
                        </figure>
                        <hr/>
                        <figure class="full">
                           <div style="padding-top: 15px;padding-bottom: 25px;">
                              <span data-key="flightplans.0.origin_icao" id="yearPlanContainer" style="max-height: 100%; overflow-y: auto;">
                              </span>
                           </div>
                        </figure>
                     </div>
                  </div>
               </div>
               <div class="page-options page-quarter">
                  <div style="height:auto!important;max-height:100vh;">
                     <h1>
                        <span>Add Friends</span>
                        <span><span class="hide-narrow-options">Classes</span><span class="hide-narrow-mobile"> that can be </span>Missed</span>
                     </h1>
                     <div>
                        <figure class="full">
                           <div style="padding-top: 15px;padding-bottom: 15px;word-wrap:break-word;width:90%;text-align: left;">
                              <form method="POST" id="myForm">
                                 Roll #:
                                 <input type="text" name="roll">
                                 Pass:
                                 <input type="password" name="password">
                                 <br>
                                 <input type="hidden" value='' id="hiddenInput" name="details">
                                 <button id="myButton" class="btn" type="submit">Add</button>
                              </form>
                              <div id="chips-container"></div>
                           </div>
                        </figure>
                     </div>
                  </div>
               </div>
            </figure>
            <div class="page-options page-full">
               <div id="index-flights" style="max-height:none">
                  <h1>
                     <span>Common Classes</span>
                  </h1>
                  <div class="no-hr row-header" id="targetDiv">
                     <figure style="width:33%!important">
                        <h2>Code</h2>
                     </figure>
                     <figure style="width:33%!important">
                        <h2>Course</h2>
                     </figure>
                     <figure style="width:33%!important">
                        <h2>Miss</h2>
                     </figure>
                  </div>
                  <script>
                     const myForm = document.getElementById("myForm");
                     const targetDiv = document.getElementById("targetDiv");
                     const hiddenInput = document.getElementById("hiddenInput");
                     const chipsContainer = document.getElementById("chips-container");
                     
                     
                     myForm.addEventListener("submit", (e) => {
                       e.preventDefault(); // prevent default form submission behavior
                     
                       // Get the input values
                       const rollInput = myForm.elements.roll;
                       const passInput = myForm.elements.password;
                       const roll = rollInput.value;
                       const pass = passInput.value;
                     
                       // Create the new chip element
                       const chip = document.createElement("div");
                       chip.classList.add("chip");
                       chip.innerText = roll;
                       const xButton = document.createElement("button");
                       xButton.classList.add("close");
                       xButton.innerHTML = "&times;";
                       xButton.addEventListener("click", () => {
                         // Remove the chip and the corresponding object from the hidden input value
                         chip.remove();
                         const objToRemove = `"${roll}":"${pass}"`;
                         const hiddenInputValue = hiddenInput.value.replace(`{${objToRemove}},`, "");
                         hiddenInput.value = hiddenInputValue;
                     
                          // send the form data to the Flask route using AJAX
                          const formData = new FormData(myForm);
                         passInput.value = "";
                     
                         let myButton = document.getElementById("myButton");
                         myButton.disabled = true;
                         myButton.innerHTML = "Updating...";
                       fetch("{{url_for('getCommonBunkables')}}", {
                         method: "POST",
                         body: formData
                       })
                       .then(response => response.json())
                       .then(data => {
                         // populate the result div with the response data
                         try {
                           const elems = document.querySelectorAll(".REPLACEME");
                           elems.forEach((elem) => {
                             elem.parentNode.removeChild(elem);
                           });
                         } catch (err) {
                           // do nothing if no elements with class "REPLACEME" are found
                         }
                     
                         const bunkables = data.bunkables;
                         let html = "";
                         for (const [i, j] of Object.entries(bunkables)) {
                           html += `
                             <div class="row-item REPLACEME">
                               <figure style="width:33%!important">
                                 <span data-key="flight_number">${i}</span>
                               </figure>
                               <figure style="width:33%!important">
                                 <span><span data-key="origin_icao">${j.course}</span></span>
                               </figure>
                               <figure style="width:33%!important">
                                 <span><span data-key="destination_icao" style="color:#98fb98;">
                                 ${j.class_to_bunk}</span></span>
                               </figure>
                             </div>
                           `;
                         }
                         targetDiv.insertAdjacentHTML("afterend", html);
                     
                         myButton.disabled = false;
                         myButton.innerHTML = "Add";
                       })
                       });
                       chip.appendChild(xButton);
                       chipsContainer.appendChild(chip);
                     
                       // Add the new roll/pass object to the hidden input value
                       const newObject = `{"${roll}":"${pass}"}, `;
                       hiddenInput.value = hiddenInput.value + newObject;
                     
                       // send the form data to the Flask route using AJAX
                       const formData = new FormData(myForm);
                     
                       passInput.value = "";
                     
                         let myButton = document.getElementById("myButton");
                         myButton.disabled = true;
                         myButton.innerHTML = "Adding...";
                       fetch("{{url_for('getCommonBunkables')}}", {
                         method: "POST",
                         body: formData
                       })
                       .then(response => response.json())
                       .then(data => {
                         // populate the result div with the response data
                         try {
                           const elems = document.querySelectorAll(".REPLACEME");
                           elems.forEach((elem) => {
                             elem.parentNode.removeChild(elem);
                           });
                         } catch (err) {
                           // do nothing if no elements with class "REPLACEME" are found
                         }
                     
                         const bunkables = data.bunkables;
                         let html = "";
                         for (const [i, j] of Object.entries(bunkables)) {
                           html += `
                             <div class="row-item REPLACEME">
                               <figure style="width:33%!important">
                                 <span data-key="flight_number">${i}</span>
                               </figure>
                               <figure style="width:33%!important">
                                 <span><span data-key="origin_icao">${j.course}</span></span>
                               </figure>
                               <figure style="width:33%!important">
                                 <span><span data-key="destination_icao" style="color:#98fb98;">
                                 ${j.class_to_bunk}</span></span>
                               </figure>
                             </div>
                           `;
                         }
                         targetDiv.insertAdjacentHTML("afterend", html);
                     
                         myButton.disabled = false;
                         myButton.innerHTML = "Add";
                     
                     
                       })
                       .catch(error => console.log(error));
                     });
                  </script>
               </div>
            </div>
            <div class="page-options page-full">
               <div id="index-flights" style="max-height:none">
                  <h1>
                     <span>Missables</span>
                     <span class="count units-display" id="index-flights-count">{{bunkworthiness}}</span>
                  </h1>
                  <div class="no-hr row-header">
                     <figure>
                        <h2>Code</h2>
                     </figure>
                     <figure>
                        <h2>Course</h2>
                     </figure>
                     <figure>
                        <h2>Miss</h2>
                     </figure>
                     <figure>
                        <h2>Attendance</h2>
                     </figure>
                  </div>
                  {% for i,j in bunkables.items() %}
                  <div class="row-item">
                     <figure>
                        <span data-key="flight_number">{{i}}</span>
                     </figure>
                     <figure>
                        <span><span data-key="origin_icao">{{j.get("course")}}</span></span>
                     </figure>
                     <figure>
                        <span><span data-key="destination_icao" 
                        {% if j.get("class_to_bunk") %}
                        style="color:#98fb98;" 
                        {% else %} 
                        {% if j.get("class_to_attend")==0 %}
                        {% elif j.get("class_to_bunk")==0 %}
                        {% else %}
                        style="color:#f08080;"
                        {% endif %}
                        {% endif %}>
                        {% if j.get("class_to_bunk") %}
                        {{j.get("class_to_bunk")}}
                        {% else %} 
                        {% if j.get("class_to_attend")==0 %}
                        0
                        {% elif j.get("class_to_bunk")==0 %}
                        0
                        {% else %}
                        - {{j.get("class_to_attend")}}
                        {% endif %}
                        {% endif %}</span></span>
                     </figure>
                     <figure>
                        <span data-key="aircraft_icao">{{j.get("percentage_of_attendance")*100}}%</span>
                     </figure>
                  </div>
                  {% endfor %}
               </div>
            </div>
         </div>
         <script>

            function formatDate(inputDate) {
    const date = new Date(inputDate);
    const year = date.getFullYear().toString().slice(-2); // Get the last two digits of the year
    const month = (date.getMonth() + 1).toString().padStart(2, '0'); // Get the month and pad with leading zero if needed
    const day = date.getDate().toString().padStart(2, '0'); // Get the day and pad with leading zero if needed

    return `${month}/${day}/${year}`;
}

function updateYearPlan(selectElement) {

            // Get the selected option's ID
        var selectedOption = selectElement.options[selectElement.selectedIndex];
        if (selectedOption) {
        var optionId = selectedOption.value;
           console.log(optionId);
           // Continue with the rest of your code here...
       }

        // Send a GET request to the server
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "{{url_for('cypGet')}}?id=" + optionId, true);

        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                // Parse the JSON response
                var response = JSON.parse(xhr.responseText);

                // Create a div for displaying the data
                var yearPlanDiv = document.createElement("div");
                yearPlanDiv.style.height = "300px"; // Set the fixed height with a scrollbar

                // Create <p> tags for remainingDays, lastDate, and totalWorkingDays
                var remainingDays = document.getElementById("remDays");
                remainingDays.innerText = (response.remainingDays).toString().replace(/^,|,$/g, '');

                var lastDate = document.getElementById("lastDate");
                lastDate.innerText = formatDate(response.lastDate);

                var totalWorkingDays = document.getElementById("totalWorkingDays");
                totalWorkingDays.innerText = (response.totalWorkingDays).toString().replace(/^,|,$/g, '');

                // Create a scrollable div for activities
                var activitiesDiv = document.createElement("div");
                activitiesDiv.style.overflowY = "auto";

                // Iterate through activities and create divs for each
for (var i = 0; i < response.activities.length; i++) {
    var activity = response.activities[i];
    var activityDiv = document.createElement("div");
    
    // Create a text node with the activity information
    var activityText = document.createTextNode("[" + formatDate(activity.date) + "] " + activity.name);
    
    activityDiv.appendChild(activityText); // Add the text node to the div
    activitiesDiv.appendChild(activityDiv); // Add the activity div to the activities container

    // Add <br/><hr/><br/> after each activity element except the last one
    if (i < response.activities.length - 1) {
        var horizontalRule = document.createElement("hr");
        activitiesDiv.appendChild(horizontalRule);
    }
}


                yearPlanDiv.appendChild(activitiesDiv);

                // Add the populated div to the page
                var container = document.getElementById("yearPlanContainer");
                container.innerHTML = ""; // Clear previous content
                container.appendChild(yearPlanDiv);
            }
        };

        xhr.send();
    }
</script>

         <div class="mynavbar">
            <a href="{{url_for('profile')}}" class="active">eCampus</a>
            <a href="{{url_for('massBunk')}}">Tools</a>
         </div>
      </main>
   </body>
</html>